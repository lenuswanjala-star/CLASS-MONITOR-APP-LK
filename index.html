
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Class Monitor App</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background:#f2f2f2; }
  table { border-collapse: collapse; width: 100%; background:#fff; }
  th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
  th { background:#007BFF; color:#fff; }
  button { margin:5px; padding:5px 10px; cursor:pointer; }
  input { padding:5px; margin:5px 0; }
  .locked { color:red; font-weight:bold; }
</style>
<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
<script src="https://www.gstatic.com/firebasejs/10.9.3/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.9.3/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.9.3/firebase-firestore-compat.js"></script>
</head>
<body>
<div id="root">Loading...</div>
<script>
const e = React.createElement;

// Replace with your Firebase config
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID",
};

try {
  firebase.initializeApp(firebaseConfig);
} catch (err) {
  document.getElementById("root").innerText = "Firebase init error: " + err.message;
}

const auth = firebase.auth();
const db = firebase.firestore();

function App() {
  const [loading, setLoading] = React.useState(true);
  const [error, setError] = React.useState(null);
  const [user, setUser] = React.useState(null);
  const [role, setRole] = React.useState("");
  const [students, setStudents] = React.useState([]);
  const [studentName, setStudentName] = React.useState("");
  const [currentScreen, setCurrentScreen] = React.useState("dashboard");

  React.useEffect(() => {
    try {
      const unsubscribeAuth = auth.onAuthStateChanged(u => {
        setUser(u);
        setRole(u ? (u.email.includes("teacher") ? "teacher" : "student") : "");
        setLoading(false);
      });
      const unsubscribeStudents = db.collection("students").onSnapshot(snap => {
        setStudents(snap.docs.map(d => ({id:d.id,...d.data()})));
      });
      return () => { unsubscribeAuth(); unsubscribeStudents(); };
    } catch(err) {
      setError(err.message); setLoading(false);
    }
  }, []);

  if (loading) return e('div', null, 'Loading Firebase...');
  if (error) return e('div',{style:{color:'red'}}, 'Error: '+error);
  if (!user) return e('div',null,
      e('p',null,'Login as:'),
      e('button',{onClick:()=>auth.signInWithEmailAndPassword('teacher@example.com','password123').catch(e=>setError(e.message))},'Teacher'),
      e('button',{onClick:()=>auth.signInWithEmailAndPassword('student@example.com','password123').catch(e=>setError(e.message))},'Student'),
      error ? e('p',{style:{color:'red'}},error):null
  );

  // Teacher view
  if(role==="teacher"){
    const addStudent = ()=>{
      if(!studentName) return;
      db.collection("students").add({name:studentName, screen:"dashboard", locked:false, lastActive:new Date().toISOString()})
        .catch(err=>setError(err.message));
      setStudentName("");
    };
    const toggleLock = (id,state)=>db.collection("students").doc(id).update({locked:state}).catch(err=>setError(err.message));

    return e('div',null,
      e('p',null,`Welcome Teacher (${user.email})`),
      e('button',{onClick:()=>auth.signOut()},'Logout'),
      e('h3',null,'Add Student'),
      e('input',{type:'text',placeholder:'Student Name',value:studentName,onChange:e=>setStudentName(e.target.value)}),
      e('button',{onClick:addStudent},'Add'),
      e('h3',null,'Student Activity'),
      e('table',null,
        e('thead',null,e('tr',null,e('th',null,'Name'),e('th',null,'Screen'),e('th',null,'Locked'),e('th',null,'Actions'))),
        e('tbody',null,students.map(s=>e('tr',{key:s.id},
          e('td',null,s.name),
          e('td',null,s.screen),
          e('td',null,s.locked?'Yes':'No'),
          e('td',null,e('button',{onClick:()=>toggleLock(s.id,!s.locked)},s.locked?'Unlock':'Lock'))
        )))
      )
    );
  }

  // Student view
  const studentDoc = students.find(s=>s.name===user.email.split('@')[0]);
  const isLocked = studentDoc?.locked || false;
  const changeScreen = screen=>{
    setCurrentScreen(screen);
    if(studentDoc && !studentDoc.locked){
      db.collection("students").doc(studentDoc.id).update({screen,lastActive:new Date().toISOString()})
        .catch(err=>setError(err.message));
    }
  };

  return e('div',null,
    e('p',null,`Welcome Student (${user.email})`),
    e('button',{onClick:()=>auth.signOut()},'Logout'),
    e('h3',null,'Dashboard'),
    e('p',null,`Current screen: ${currentScreen}`),
    isLocked?e('p',{className:'locked'},'Your screens are locked!'):null,
    e('button',{onClick:()=>changeScreen("dashboard"),disabled:isLocked},'Dashboard'),
    e('button',{onClick:()=>changeScreen("assignments"),disabled:isLocked},'Assignments'),
    e('button',{onClick:()=>changeScreen("quiz"),disabled:isLocked},'Quiz')
  );
}

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(e(App));
</script>
</body>
</html>
