<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Class Monitor App</title>
<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
  h2 { color: #007BFF; }
  input, button { padding: 5px 10px; margin: 5px; }
  table { border-collapse: collapse; width: 100%; background: #fff; margin-top: 10px; }
  th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
  th { background: #007BFF; color: white; }
  .locked { color: red; font-weight: bold; }
</style>
<script src="https://www.gstatic.com/firebasejs/10.9.3/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.9.3/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.9.3/firebase-firestore-compat.js"></script>
</head>
<body>
<div id="root">Loading...</div>
<script>
// -------------------- Firebase Setup --------------------
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// -------------------- App Logic --------------------
const root = document.getElementById("root");

function render() {
  root.innerHTML = "Loading...";
  
  auth.onAuthStateChanged(user => {
    if(!user) {
      showLogin();
    } else {
      if(user.email.includes("teacher")) {
        showTeacherDashboard();
      } else {
        showStudentDashboard(user);
      }
    }
  });
}

// -------------------- Login Screen --------------------
function showLogin() {
  root.innerHTML = `
    <h2>Login</h2>
    <button id="teacherLogin">Login as Teacher</button>
    <button id="studentLogin">Login as Student</button>
    <p id="error" style="color:red"></p>
  `;
  document.getElementById("teacherLogin").onclick = () => {
    auth.signInWithEmailAndPassword("teacher@example.com","password123")
      .catch(err => document.getElementById("error").innerText = err.message);
  };
  document.getElementById("studentLogin").onclick = () => {
    auth.signInWithEmailAndPassword("student@example.com","password123")
      .catch(err => document.getElementById("error").innerText = err.message);
  };
}

// -------------------- Teacher Dashboard --------------------
function showTeacherDashboard() {
  db.collection("students").onSnapshot(snapshot => {
    const students = snapshot.docs.map(doc => ({id:doc.id,...doc.data()}));
    root.innerHTML = `
      <h2>Teacher Dashboard</h2>
      <button id="logout">Logout</button>
      <h3>Add Student</h3>
      <input id="studentName" placeholder="Student Name">
      <button id="addStudent">Add</button>
      <h3>Students</h3>
      <table>
        <thead><tr><th>Name</th><th>Screen</th><th>Locked</th><th>Actions</th></tr></thead>
        <tbody id="studentList"></tbody>
      </table>
    `;
    document.getElementById("logout").onclick = () => auth.signOut();
    document.getElementById("addStudent").onclick = () => {
      const name = document.getElementById("studentName").value.trim();
      if(name) {
        db.collection("students").add({name, screen:"dashboard", locked:false, lastActive:new Date().toISOString()});
        document.getElementById("studentName").value = "";
      }
    };
    const tbody = document.getElementById("studentList");
    tbody.innerHTML = "";
    students.forEach(s => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${s.name}</td>
        <td>${s.screen}</td>
        <td>${s.locked?"Yes":"No"}</td>
        <td><button id="toggle${s.id}">${s.locked?"Unlock":"Lock"}</button></td>
      `;
      tbody.appendChild(tr);
      document.getElementById("toggle"+s.id).onclick = () => {
        db.collection("students").doc(s.id).update({locked:!s.locked});
      };
    });
  });
}

// -------------------- Student Dashboard --------------------
function showStudentDashboard(user) {
  db.collection("students").where("name","==",user.email.split("@")[0]).onSnapshot(snapshot => {
    const student = snapshot.docs[0]?.data();
    const studentId = snapshot.docs[0]?.id;
    if(!student) return;
    const locked = student.locked;
    root.innerHTML = `
      <h2>Student Dashboard</h2>
      <button id="logout">Logout</button>
      <p>Current screen: <span id="screenName">${student.screen}</span></p>
      ${locked?'<p class="locked">Your screens are locked!</p>':''}
      <button id="dash" ${locked?'disabled':''}>Dashboard</button>
      <button id="assign" ${locked?'disabled':''}>Assignments</button>
      <button id="quiz" ${locked?'disabled':''}>Quiz</button>
    `;
    document.getElementById("logout").onclick = () => auth.signOut();
    function changeScreen(name) {
      if(!locked) {
        db.collection("students").doc(studentId).update({screen:name,lastActive:new Date().toISOString()});
      }
    }
    document.getElementById("dash").onclick = ()=>changeScreen("dashboard");
    document.getElementById("assign").onclick = ()=>changeScreen("assignments");
    document.getElementById("quiz").onclick = ()=>changeScreen("quiz");
  });
}

render();
</script>
</body>
</html>
